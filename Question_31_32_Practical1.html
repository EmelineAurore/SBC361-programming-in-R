<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="theme.css" type="text/css" />
</head>
<body>
<h1 id="computing-in-r---questions-31-and-32---practical-1">Computing in R - Questions 31 and 32 - Practical 1</h1>
<h2 id="sbc361-research-methods-and-communication---october-2015">SBC361: Research Methods and Communication - October 2015</h2>
<p>What follow are some ideas of how to answer those last few questions the first practical session. Remember that there are dozens of manners of answering a question, and no single one is best. We provide a few possibilities for each. Other ideas that we may not have listed are perfectly valid as well!</p>
<p>As a general rule, it can be better to be more specific, but in a real life situation you would want to include some sort of automated verification that your code is performing as you intend (in particular when you move on to larger datasets for which it is hard to have an overview).</p>
<p>Ok, ok, now let's get hacking.</p>
<h2 id="q31.-add-three-additional-columns-to-the-reptile_data-table">Q31. Add three additional columns to the reptile_data table:</h2>
<p>First let's create one vector for each; we can worry about combining them into the <code>reptile_data</code> table later.</p>
<h3 id="one-containing-only-the-identifier-numbers-e.g.-1423-without-the-id">One containing only the identifier numbers (e.g. 1423 without the “ID”):</h3>
<h4 id="it-might-be-easiest-to-do-this-in-two-steps.-for-example">It might be easiest to do this in two steps. For example:</h4>
<pre class="sourceCode R"><code class="sourceCode r">id_numbers_temp &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names,   <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;ID&quot;</span>)
id_numbers      &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> id_numbers_temp, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;:.+&quot;</span>)
<span class="kw">rm</span>(id_numbers_temp)</code></pre>
<p>This can be a bit risky though. For example, what happens if the species name contains &quot;ID&quot; or if there are multiple &quot;:&quot;? Thus, it is better to be more specific. You will be more in control of what the computer is doing, and thus it is less likely to do something you did not intend. The following example is more specific than the previous:</p>
<pre class="sourceCode R"><code class="sourceCode r">id_numbers_temp &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names,   <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;^ID&quot;</span>)
id_numbers      &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> id_numbers_temp, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;:[A-z ]+$&quot;</span>)
<span class="kw">rm</span>(id_numbers_temp)</code></pre>
<p>If we wanted our regexp to be more general (e.g. if we know that &quot;ID&quot; might be in other cases be other capitalise letters, and if some species may be unresolved and thus be abbreviated as &quot;sp.&quot;), we could for example do the following:</p>
<pre class="sourceCode R"><code class="sourceCode r">id_numbers_temp &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names,   <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;^[A-Z]+&quot;</span>)
id_numbers      &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> id_numbers_temp, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;:[A-z </span><span class="ch">\\</span><span class="st">.]+$&quot;</span>)
<span class="kw">rm</span>(id_numbers_temp)</code></pre>
<h4 id="or-we-can-combine-those-two-into-a-single-line">Or we can combine those two into a single line:</h4>
<p><code>gsub</code> can &quot;find&quot; a regular expression match multiple times. So we can combine two parts with a <code>|</code>, taking care to use parentheses appropriately. Here are some examples of combinations:</p>
<p>Risky but works:</p>
<pre class="sourceCode R"><code class="sourceCode r">id_numbers &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;([A-Z]+)|(:.+)&quot;</span>)</code></pre>
<p>Less risky because more specific while keeping some generality:</p>
<pre class="sourceCode R"><code class="sourceCode r">id_numbers &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;(^[A-z]+)|(:[A-z </span><span class="ch">\\</span><span class="st">.]+$)&quot;</span>)</code></pre>
<p>Specific for this dataset:</p>
<pre class="sourceCode R"><code class="sourceCode r">id_numbers &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;(^ID)|(:[A-z ]+$)&quot;</span>)</code></pre>
<h4 id="or-we-take-a-minimalistic-approach-by-exclusion-of-everything-that-is-not-a-number">Or we take a minimalistic approach by exclusion of everything that is not a number:</h4>
<pre class="sourceCode R"><code class="sourceCode r">id_numbers &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;[^0-9]&quot;</span>)</code></pre>
<h3 id="one-column-containing-only-the-genus-e.g.-bellatorias">One column containing only the genus (e.g. Bellatorias):</h3>
<p>Risky, but works:</p>
<pre class="sourceCode R"><code class="sourceCode r">only_genus_temp &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names,   <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;(.+:)&quot;</span>)
only_genus      &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> only_genus_temp, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;( .+)&quot;</span>)
<span class="kw">rm</span>(only_genus_temp)</code></pre>
<p>More specific, less risky:</p>
<pre class="sourceCode R"><code class="sourceCode r">only_genus_temp &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names,   <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;([A-z]+[0-9]+:)&quot;</span>)
only_genus      &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> only_genus_temp, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;( [A-z]+)&quot;</span>)
<span class="kw">rm</span>(only_genus_temp)</code></pre>
<h4 id="we-can-also-combine-those-two-options-above-each-one-into-one-single-line">We can also combine those two options above, each one into one single line:</h4>
<p>Risky:</p>
<pre class="sourceCode R"><code class="sourceCode r">only_genus &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;(.+:)|( .+)&quot;</span>)</code></pre>
<p>Less risky:</p>
<pre class="sourceCode R"><code class="sourceCode r">only_genus &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;([A-z]+[0-9]+:)|( [A-z]+)&quot;</span>)</code></pre>
<h3 id="one-column-containing-only-the-species-excluding-the-subspecies-e.g.-tympanum">One column containing only the species (excluding the subspecies, e.g. tympanum):</h3>
<h4 id="as-mentioned-above-it-is-easier-to-do-it-in-two-steps">As mentioned above, it is easier to do it in two steps:</h4>
<p>Risky:</p>
<pre class="sourceCode R"><code class="sourceCode r">only_species_temp &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names,     <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;(.+:)&quot;</span>)
only_species      &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> only_species_temp, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;(^[A-z]+ )|( .+$)&quot;</span>)
<span class="kw">rm</span>(only_species_temp)</code></pre>
<p>We can make our code more readable being more specific, thus less risky:</p>
<pre class="sourceCode R"><code class="sourceCode r">only_species_temp &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names,     <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;([A-z]+[0-9]+:)&quot;</span>)
only_species      &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> only_species_temp, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;(^[A-z]+ )|( [A-z]+$)&quot;</span>)
<span class="kw">rm</span>(only_species_temp)</code></pre>
<h4 id="we-can-also-combine-the-above-scripts-into-one-single-line-each">We can also combine the above scripts into one single line each:</h4>
<p>Risky:</p>
<pre class="sourceCode R"><code class="sourceCode r">only_species &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;(.+:)([A-z]+ )|( .+$)&quot;</span>)</code></pre>
<p>Less risky:</p>
<pre class="sourceCode R"><code class="sourceCode r">only_species &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;(^[A-z]+[0-9]+:)([A-z]+ )|( [A-z]+$)&quot;</span>)</code></pre>
<h4 id="now-you-can-add-the-columns-to-the-reptile_data-table">Now you can add the columns to the reptile_data table:</h4>
<p>We can use <code>cbind</code> for this:</p>
<pre class="sourceCode R"><code class="sourceCode r">reptile_data_q31 &lt;- <span class="kw">cbind</span>(reptile_data, id_numbers, only_genus, only_species)</code></pre>
<p>Or we can use the <code>$</code>. For example, <code>reptile_data$V4</code> would pull out the year. If we try to access <code>reptile_data$id_numbers</code>, that does not exist. However, we can create it:</p>
<pre class="sourceCode R"><code class="sourceCode r">reptile_data$id_numbers &lt;- id_numbers</code></pre>
<p>And so on for the others. Or we can use the <code>[]</code> square brackets. I find this more risky because it is hard to remember whether rows or columns come first. Anyhow, here is one way with a named column:</p>
<pre class="sourceCode R"><code class="sourceCode r">reptile_data[, <span class="st">&#39;id_numbers&#39;</span>] &lt;- id_numbers</code></pre>
<p>And another way (even more risky), just using the column number. I dislike this approach because it is easy to accidentally overwrite an existing column:</p>
<pre class="sourceCode R"><code class="sourceCode r">reptile_data[, <span class="dv">5</span>] &lt;- id_numbers</code></pre>
<p>Obviously, you could also combine the data modification and merging into the table into a single step creation instead of doing it in multiple steps. For example:</p>
<pre class="sourceCode R"><code class="sourceCode r"><span class="co"># This could have been the complete answer for the first part.</span>
reptile_data$id_numbers &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;[^0-9]&quot;</span>)

<span class="co"># This could have been the complete answer for the second part.</span>
reptile_data$only_genus &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;([A-z]+[0-9]+:)|( [A-z]+)&quot;</span>)

<span class="co"># This could have been the complete answer for the last part.</span>
reptile_data$only_species &lt;- <span class="kw">gsub</span>(<span class="dt">x           =</span> reptile_names, 
                  <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, 
                  <span class="dt">pattern     =</span> <span class="st">&quot;(^[A-z]+[0-9]+:)([A-z]+ )|( [A-z]+$)&quot;</span>
                  )</code></pre>
<p>Or:</p>
<pre class="sourceCode R"><code class="sourceCode r">reptile_data_q31 &lt;- <span class="kw">cbind</span>(reptile_data, 
              <span class="dt">id_numbers   =</span> <span class="kw">gsub</span>(<span class="dt">x           =</span> reptile_names, 
                                  <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, 
                                  <span class="dt">pattern     =</span> <span class="st">&quot;[^0-9]&quot;</span>
                                  ), 
              <span class="dt">only_genus   =</span> <span class="kw">gsub</span>(<span class="dt">x           =</span> reptile_names, 
                                  <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, 
                                  <span class="dt">pattern     =</span> <span class="st">&quot;(^[A-z]+[0-9]+:)|( [A-z]+$)&quot;</span>
                                  ), 
              <span class="dt">only_species =</span> <span class="kw">gsub</span>(<span class="dt">x           =</span> reptile_names, 
                                  <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, 
                                  <span class="dt">pattern     =</span> <span class="st">&quot;(^[A-z]+[0-9]+:)([A-z]+ )|( [A-z]+$)&quot;</span>
                                  )
              )</code></pre>
<h2 id="hacker-q32.-figure-out-how-to-capture-the-first-letter-of-the-species-and-transform-it-to-make-it-uppercase.-do-this-in-a-generic-manner-that-would-work-on-a-table-of-thousands-of-species.">Hacker Q32. Figure out how to “capture” the first letter of the species, and transform it to make it uppercase. Do this in a generic manner (that would work on a table of thousands of species).</h2>
<h3 id="easiest-way-using-captures">Easiest way, using captures:</h3>
<p>Here we are decomposing:</p>
<pre class="sourceCode R"><code class="sourceCode r"><span class="co"># Since we will be using the same &#39;pattern&#39;, we write the regexp only once to reduce risks</span>
multi_part_regexp      &lt;- <span class="st">&quot;^([A-z]+[0-9]+:[A-z]+ )(.)([a-z ]+$)&quot;</span>

<span class="co"># Every number in the &#39;replacement&#39; below stands for: keep the equivalent group</span>
<span class="co"># (anything between parentheses in our regexp) the way it is and delete the rest.</span>
<span class="co"># Therefore, the &#39;first_part&#39; variable will contain only what is described</span>
<span class="co"># in the first group (parentheses) of our regexp.</span>
<span class="co"># Thus, let&#39;s replace the whole string by just the first group, delete the rest</span>
<span class="co"># and store the result in a variable. Then repeat for other two parenthesis groups:</span>
first_part             &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names, <span class="dt">replacement =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&quot;</span>, <span class="dt">pattern =</span> multi_part_regexp)
last_part              &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names, <span class="dt">replacement =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">3&quot;</span>, <span class="dt">pattern =</span> multi_part_regexp)
species_first_char     &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names, <span class="dt">replacement =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">2&quot;</span>, <span class="dt">pattern =</span> multi_part_regexp)

<span class="co"># Put the species_first_char variable in uppercase. Google &quot;uppercase in R&quot; finds the toupper function!</span>
species_first_char_big &lt;- <span class="kw">toupper</span>(species_first_char)

<span class="co"># You can also do the &#39;uppercase step&#39; without creating the &#39;species_first_char&#39; variable. For example:</span>
species_first_char_big &lt;- <span class="kw">toupper</span>(<span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names, <span class="dt">replacement =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">2&quot;</span>, <span class="dt">pattern =</span> multi_part_regexp))

reptile_names_q32      &lt;- <span class="kw">paste</span>(first_part, species_first_char_big, last_part, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</code></pre>
<h3 id="alternative-way-without-captures">Alternative way, without captures:</h3>
<pre class="sourceCode R"><code class="sourceCode r">first_part             &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot; .+&quot;</span>)
species                &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> reptile_names, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;[A-z]+[0-9]+:[A-z]+&quot;</span>)

<span class="co"># Google &quot;extract part of string in R&quot; finds the substr function!</span>
species_first_char     &lt;- <span class="kw">substr</span>(<span class="dt">x =</span> species, <span class="dt">start =</span> <span class="dv">0</span>, <span class="dt">stop =</span> <span class="dv">1</span>)
species_first_char_big &lt;- <span class="kw">toupper</span>(species_first_char)

<span class="co"># or in one step (without the &#39;species_first_char&#39; variable):</span>
species_first_char_big &lt;- <span class="kw">toupper</span>(<span class="kw">substr</span>(<span class="dt">x =</span> species, <span class="dt">start =</span> <span class="dv">0</span>, <span class="dt">stop =</span> <span class="dv">1</span>))

species_rest           &lt;- <span class="kw">gsub</span>(<span class="dt">x =</span> species, <span class="dt">pattern =</span> <span class="st">&quot;^.&quot;</span>, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>)
reptile_names_q32      &lt;- <span class="kw">paste</span>(first_part, species_first_char_big, species_rest, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</code></pre>
<h3 id="with-captures-and-perl-extensions-both-in-one-single-line-each">With captures and perl extensions, both in one single line each:</h3>
<pre class="sourceCode R"><code class="sourceCode r">reptile_names_q32 &lt;- <span class="kw">gsub</span>(<span class="dt">x           =</span> reptile_names,
                          <span class="dt">pattern     =</span> <span class="st">&quot;(^ID[0-9]+:[A-z]+ )([A-z])([a-z ]+$)&quot;</span>,
                          <span class="dt">replacement =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1</span><span class="ch">\\</span><span class="st">U</span><span class="ch">\\</span><span class="st">2</span><span class="ch">\\</span><span class="st">L</span><span class="ch">\\</span><span class="st">3&quot;</span>,
                          <span class="dt">perl        =</span> <span class="ot">TRUE</span>
                          )</code></pre>
<p>A less specific approach:</p>
<pre class="sourceCode R"><code class="sourceCode r">reptile_names_q32 &lt;- <span class="kw">gsub</span>(<span class="dt">x           =</span> reptile_names, 
                          <span class="dt">pattern     =</span> <span class="st">&quot;(^[A-z:0-9]+ )(.)(.+)$&quot;</span>, 
                          <span class="dt">replacement =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1</span><span class="ch">\\</span><span class="st">U</span><span class="ch">\\</span><span class="st">2</span><span class="ch">\\</span><span class="st">L</span><span class="ch">\\</span><span class="st">3&quot;</span>, 
                          <span class="dt">perl        =</span> <span class="ot">TRUE</span>
                          )</code></pre>
</body>
</html>
